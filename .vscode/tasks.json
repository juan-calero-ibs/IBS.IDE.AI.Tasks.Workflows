{
    "version": "2.0.0",
    "tasks": [
        // --------------------- TOMCAT ---------------------
        {
            "label": "[TOMCAT] üöÄ Start Tomcat",
            "type": "shell",
            "command": "nohup /opt/abvprp/apache-tomcat-8.0.35/bin/catalina.sh start >/opt/abvprp/apache-tomcat-8.0.35/logs/vscode-start.log 2>&1 &",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // üëà hides the actual command line
                "close": true,
                "focus": false
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] üõë Stop Tomcat",
            "type": "shell",
            "command": "/opt/abvprp/apache-tomcat-8.0.35/bin/catalina.sh stop",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // üëà hides the actual command line
                "close": true,
                "focus": true
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] üõë Force Stop Tomcat (Kill)",
            "type": "shell",
            "command": "pkill -f '/opt/abvprp/apache-tomcat-8.0.35/bin/tomcat-juli.jar' || true; sleep 6; pkill -9 -f '/opt/abvprp/apache-tomcat-8.0.35/bin/tomcat-juli.jar' || true",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // üëà hides the actual command line
                "close": true,
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] üì° Check Tomcat Port 8080",
            "type": "shell",
            "command": "lsof -i :8080 && echo \"[$(date '+%Y-%m-%d %H:%M:%S')] ‚úÖ Tomcat is listening on port 8080\" || echo \"[$(date '+%Y-%m-%d %H:%M:%S')] üõë No listener found on port 8080\"",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // üëà hides the actual command line
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] ü™µ View Tomcat Logs",
            "type": "shell",
            "command": "tail -f catalina.out",
            "options": {
                "cwd": "/opt/abvprp/apache-tomcat-8.0.35/logs"
            },
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] üß± Build aboveproperty WAR",
            "type": "shell",
            // "command": "./buildIntegratedWAR.sh -branch ${input:branch}| && echo \"‚úÖ SUCCESS - Copy WAR to Tomcat\" || echo \"üõë Build failed\"",
            "command": "./buildIntegratedWAR.sh -branch ${input:branch} && echo \"[$(date '+%Y-%m-%d %H:%M:%S')] ‚úÖ SUCCESS ‚ö†Ô∏è Remember to copy WAR to Tomcat\" || echo \"[$(date '+%Y-%m-%d %H:%M:%S')] üõë fail\" ",
            "options": {
                "cwd": "../aboveproperty/aboveproperty.war"
            },
            "presentation": {
                "echo": false, // üëà hides the actual command line
                "panel": "new", // üÜï this makes each run use a fresh terminal
                "clear": true,
                "focus": true
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] üöö Copy aboveproperty WAR ‚û°Ô∏è Tomcat webapps",
            "type": "shell",
            "command": "mv ROOT.war ROOT.war_$(date +\"%Y%m%d_%H%M%S\").BAK && cp ~/src/github.com/aboveproperty/aboveproperty.war/target/aboveproperty-war-develop.war ROOT.war && ls -alrt",
            "options": {
                "cwd": "/opt/abvprp/apache-tomcat/webapps/"
            },
            "presentation": {
                "echo": false, // üëà hides the actual command line
                "panel": "new", // üÜï this makes each run use a fresh terminal
            },
            "problemMatcher": []
        },
        // --------------------- SPLUNK ---------------------
        {
            "label": "üü© ‚ñ∂ Start SPLUNK",
            "type": "shell",
            "command": "/Applications/Splunk/bin/splunk start && echo \"‚úÖ Splunk started\" || echo \"‚ö†Ô∏è Failed to start Splunk\"",
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© ‚õî Stop SPLUNK",
            "type": "shell",
            "command": "/Applications/Splunk/bin/splunk stop && echo \"‚úÖ Splunk stopped\" || echo \"‚ö†Ô∏è Failed to stop Splunk\"",
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© üóëüßπ delete SPLUNK logsü™µ",
            "type": "shell",
            "command": "rm -rf ~/Documents/splunk/bablefish/* && echo \"[$(date '+%Y-%m-%d %H:%M:%S')] ‚úÖ Deleted SPLUNK logs in bablefish folder\" || echo \"[$(date '+%Y-%m-%d %H:%M:%S')] üõë Failed to delete SPLUNK logs in bablefish folder\"",
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© üì• Download SPLUNK Logs",
            "type": "shell",
            "command": "gcloud",
            "args": [
                "storage",
                "cp",
                "-r",
                "--do-not-decompress",
                "gs://abvprp-logs-fluentd/logs/20${input:year}/${input:month}/${input:day}/${input:hour}/${input:logFile}.log/\\*${input:serverURL}\\*",
                "~/Documents/splunk/bablefish"
            ],
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© ‚ôªÔ∏è Restart SPLUNK (splunkcycle)",
            "type": "shell",
            "command": "zsh",
            "args": [
                "-i",
                "-c",
                "source ~/.zshrc; splunkcycle"
            ],
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© üåê Open SPLUNK in Safari",
            "type": "shell",
            "command": "open -a Safari 'http://localhost:8000/en-US/'",
            "presentation": {
                "panel": "shared",
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© üóÇÔ∏è Backup bablefish with timestamp",
            "type": "shell",
            "command": "timestamp=$(date +\"%Y%m%d_%H%M%S\") && src=\"$HOME/Documents/splunk/bablefish\" && dest=\"$HOME/Documents/splunk/bablefish_$timestamp\" && if [ -d \"$src\" ]; then mv \"$src\" \"$dest\" && echo \"‚úÖ Backup created: $dest\"; else echo \"‚ö†Ô∏è No folder found at $src\"; fi && mkdir -p \"$src\" && echo \"üìÅ New folder created at $src\"",
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© üìÇ Merge all bablefish backups",
            "type": "shell",
            "command": "for d in $HOME/Documents/splunk/bablefish_*; do if [ -d \"$d\" ]; then echo \"üì¶ Copying from $d...\"; cp -rn \"$d\"/* \"$HOME/Documents/splunk/bablefish/\" 2>/dev/null || true; fi; done && echo \"‚úÖ All backups copied safely into $HOME/Documents/splunk/bablefish (no overwrites)\"",
            "presentation": {
                "panel": "new", // üÜï this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "üü© üß≠ SPLUNK workflow üß≠ üóëüßπ üì• ‚ñ∂ üåê ",
            "dependsOrder": "sequence",
            "dependsOn": [
                "üü© ‚õî Stop SPLUNK",
                "üü© üóëüßπ delete SPLUNK logsü™µ",
                "üü© üì• Download SPLUNK Logs",
                "üü© ‚ñ∂ Start SPLUNK",
                "üü© üåê Open SPLUNK in Safari"
            ],
            "presentation": {
                "panel": "shared",
                "reveal": "always"
            }
        },
        // --------------------- SPLUNK ---------------------
        {
            "label": "[UTILS] ‚è≥ Wait 5 seconds",
            "type": "shell",
            "command": "sleep 5 && echo 'üïê Waited 5 seconds...'",
            "presentation": {
                "reveal": "always",
                "panel": "shared",
                "group": "UTILS",
                "close": true,
            },
            "problemMatcher": []
        },
        // --------------------- Run Patch ---------------------
        {
            "label": "ü©πüöÄ Run Patch (macOS/Linux)",
            "type": "shell",
            "command": "sh migrateData.sh -e ${input:env} -t $TARGET_HOST -p $HTTP_ADMIN_PASSWORD -l $LOAD_TOKEN",
            "options": {
                "cwd": "${env:HOME}/src/github.com/aboveproperty/aboveproperty.data/cassandra/patches/${input:patchId}",
                "env": {
                    "CASSANDRA_HOST": "${input:cassandraHost}",
                    "TARGET_HOST": "${input:targetHost}",
                    "HTTP_ADMIN_PASSWORD": "${input:adminPassword}",
                    "TARGET": "${input:targetHost}",
                    "LOAD_TOKEN": "${input:loadToken}",
                    "MATLOCK_HOST": "${input:matlockHost}",
                    "SOLR_HOST": "${input:solrHost}"
                }
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "clear": true
            }
        }
    ],
    "inputs": [
        {
            "id": "year",
            "type": "promptString",
            "description": "Enter year (e.g. 24 for 2024)",
            "default": "25"
        },
        {
            "id": "month",
            "type": "promptString",
            "description": "Enter month (e.g. 01 for January)",
            "default": "10"
        },
        {
            "id": "day",
            "type": "promptString",
            "description": "Enter start day (e.g. 01)",
            "default": "01"
        },
        {
            "id": "hour",
            "type": "promptString",
            "description": "Enter start hour (e.g. 05)",
            "default": "02"
        },
        {
            "id": "branch",
            "type": "promptString",
            "description": "Enter branch name (e.g. current, develop, feature-xyz)",
            "default": "current"
        },
        {
            "id": "logFile",
            "type": "pickString",
            "description": "Select log file",
            "options": [
                "babelfish",
                "profiler",
                "server",
                "trx-aps",
                "trx-babelfish",
                "trx-bonotel-rps",
                "trx-ctrip",
                "trx-derbysoft",
                "trx-expedia-rapid-availability",
                "trx-google",
                "trx-ota",
                "trx-tripadvisor",
                "trx"
            ],
            "default": "trx"
        },
        {
            "id": "serverURL",
            "type": "promptString",
            "description": "Enter server URL filter (e.g. ip-10-20-1-8, west, prod.abvprp.com) null value gets all"
        },
        {
            "id": "patchId",
            "type": "promptString",
            "description": "Patch folder name under cassandra/patches/",
            "default": "US99999"
        },
        {
            "id": "env",
            "type": "pickString",
            "description": "Environment flag for migrateData.sh (-e)",
            "options": [
                "dev",
                "qa",
                "stg",
                "prod"
            ],
            "default": "dev"
        },
        {
            "id": "cassandraHost",
            "type": "promptString",
            "description": "CASSANDRA_HOST",
            "default": "localhost"
        },
        {
            "id": "targetHost",
            "type": "promptString",
            "description": "TARGET_HOST (APS API/Tomcat)",
            "default": "http://localhost:8080"
        },
        {
            "id": "matlockHost",
            "type": "promptString",
            "description": "MATLOCK_HOST",
            "default": "http://localhost:8087"
        },
        {
            "id": "solrHost",
            "type": "promptString",
            "description": "SOLR_HOST",
            "default": "http://localhost:8983"
        },
        {
            "id": "adminPassword",
            "type": "promptString",
            "description": "HTTP_ADMIN_PASSWORD",
            "password": true,
            "default": "password1"
        },
        {
            "id": "loadToken",
            "type": "promptString",
            "description": "LOAD_TOKEN",
            "password": true,
            "default": "ioanscion2893eionsan28903e23nsinasune9udh23987h239dnqnasiun7qhd2983en31dcjnu982h239d"
        }
    ]
}