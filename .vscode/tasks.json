{
    "version": "2.0.0",
    "tasks": [
        // --------------------- TOMCAT ---------------------
        {
            "label": "[TOMCAT] ğŸš€ Start Tomcat",
            "type": "shell",
            "command": "nohup /opt/abvprp/apache-tomcat-8.0.35/bin/catalina.sh start >/opt/abvprp/apache-tomcat-8.0.35/logs/vscode-start.log 2>&1 &",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // ğŸ‘ˆ hides the actual command line
                "close": true,
                "focus": false
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] ğŸ›‘ Stop Tomcat",
            "type": "shell",
            "command": "/opt/abvprp/apache-tomcat-8.0.35/bin/catalina.sh stop",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // ğŸ‘ˆ hides the actual command line
                "close": true,
                "focus": true
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] ğŸ›‘ Force Stop Tomcat (Kill)",
            "type": "shell",
            "command": "pkill -f '/opt/abvprp/apache-tomcat-8.0.35/bin/tomcat-juli.jar' || true; sleep 6; pkill -9 -f '/opt/abvprp/apache-tomcat-8.0.35/bin/tomcat-juli.jar' || true",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // ğŸ‘ˆ hides the actual command line
                "close": true,
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] ğŸ“¡ Check Tomcat Port 8080",
            "type": "shell",
            "command": "lsof -i :8080 && echo \"[$(date '+%Y-%m-%d %H:%M:%S')] âœ… Tomcat is listening on port 8080\" || echo \"[$(date '+%Y-%m-%d %H:%M:%S')] ğŸ›‘ No listener found on port 8080\"",
            "presentation": {
                "panel": "shared",
                "reveal": "always",
                "echo": false, // ğŸ‘ˆ hides the actual command line
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] ğŸªµ View Tomcat Logs",
            "type": "shell",
            "command": "tail -f catalina.out",
            "options": {
                "cwd": "/opt/abvprp/apache-tomcat-8.0.35/logs"
            },
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] ğŸ§± Build aboveproperty WAR",
            "type": "shell",
            // "command": "./buildIntegratedWAR.sh -branch ${input:branch}| && echo \"âœ… SUCCESS - Copy WAR to Tomcat\" || echo \"ğŸ›‘ Build failed\"",
            "command": "./buildIntegratedWAR.sh -branch ${input:branch} && echo \"[$(date '+%Y-%m-%d %H:%M:%S')] âœ… SUCCESS âš ï¸ Remember to copy WAR to Tomcat\" || echo \"[$(date '+%Y-%m-%d %H:%M:%S')] ğŸ›‘ fail\" ",
            "options": {
                "cwd": "../aboveproperty/aboveproperty.war"
            },
            "presentation": {
                "echo": false, // ğŸ‘ˆ hides the actual command line
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal
                "clear": true,
                "focus": true
            },
            "problemMatcher": []
        },
        {
            "label": "[TOMCAT] ğŸšš Copy aboveproperty WAR â¡ï¸ Tomcat webapps",
            "type": "shell",
            "command": "mv ROOT.war ROOT.war_$(date +\"%Y%m%d_%H%M%S\").BAK && cp ~/src/github.com/aboveproperty/aboveproperty.war/target/aboveproperty-war-develop.war ROOT.war && ls -alrt",
            "options": {
                "cwd": "/opt/abvprp/apache-tomcat/webapps/"
            },
            "presentation": {
                "echo": false, // ğŸ‘ˆ hides the actual command line
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal
            },
            "problemMatcher": []
        },
        // --------------------- SPLUNK ---------------------
        {
            "label": "ğŸŸ© â–¶ Start SPLUNK",
            "type": "shell",
            "command": "/Applications/Splunk/bin/splunk start && echo \"âœ… Splunk started\" || echo \"âš ï¸ Failed to start Splunk\"",
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© â›” Stop SPLUNK",
            "type": "shell",
            "command": "/Applications/Splunk/bin/splunk stop && echo \"âœ… Splunk stopped\" || echo \"âš ï¸ Failed to stop Splunk\"",
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© ğŸ—‘ğŸ§¹ delete SPLUNK logsğŸªµ",
            "type": "shell",
            "command": "rm -rf ~/Documents/splunk/bablefish/* && echo \"[$(date '+%Y-%m-%d %H:%M:%S')] âœ… Deleted SPLUNK logs in bablefish folder\" || echo \"[$(date '+%Y-%m-%d %H:%M:%S')] ğŸ›‘ Failed to delete SPLUNK logs in bablefish folder\"",
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© ğŸ“¥ Download SPLUNK Logs",
            "type": "shell",
            "command": "gcloud",
            "args": [
                "storage",
                "cp",
                "-r",
                "--do-not-decompress",
                "gs://abvprp-logs-fluentd/logs/20${input:year}/${input:month}/${input:day}/${input:hour}/${input:logFile}.log/\\*${input:serverURL}\\*",
                "~/Documents/splunk/bablefish"
            ],
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© â™»ï¸ Restart SPLUNK (splunkcycle)",
            "type": "shell",
            "command": "zsh",
            "args": [
                "-i",
                "-c",
                "source ~/.zshrc; splunkcycle"
            ],
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© ğŸŒ Open SPLUNK in Safari",
            "type": "shell",
            "command": "open -a Safari 'http://localhost:8000/en-US/'",
            "presentation": {
                "panel": "shared",
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© ğŸ—‚ï¸ Backup bablefish with timestamp",
            "type": "shell",
            "command": "timestamp=$(date +\"%Y%m%d_%H%M%S\") && src=\"$HOME/Documents/splunk/bablefish\" && dest=\"$HOME/Documents/splunk/bablefish_$timestamp\" && if [ -d \"$src\" ]; then mv \"$src\" \"$dest\" && echo \"âœ… Backup created: $dest\"; else echo \"âš ï¸ No folder found at $src\"; fi && mkdir -p \"$src\" && echo \"ğŸ“ New folder created at $src\"",
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© ğŸ“‚ Merge all bablefish backups",
            "type": "shell",
            "command": "for d in $HOME/Documents/splunk/bablefish_*; do if [ -d \"$d\" ]; then echo \"ğŸ“¦ Copying from $d...\"; cp -rn \"$d\"/* \"$HOME/Documents/splunk/bablefish/\" 2>/dev/null || true; fi; done && echo \"âœ… All backups copied safely into $HOME/Documents/splunk/bablefish (no overwrites)\"",
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "echo": false,
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸŸ© ğŸ§­ SPLUNK workflow ğŸ§­ ğŸ—‘ğŸ§¹ ğŸ“¥ â–¶ ğŸŒ ",
            "dependsOrder": "sequence",
            "dependsOn": [
                "ğŸŸ© â›” Stop SPLUNK",
                "ğŸŸ© ğŸ—‘ğŸ§¹ delete SPLUNK logsğŸªµ",
                "ğŸŸ© ğŸ“¥ Download SPLUNK Logs",
                "ğŸŸ© â–¶ Start SPLUNK",
                "ğŸŸ© ğŸŒ Open SPLUNK in Safari"
            ],
            "presentation": {
                "panel": "shared",
                "reveal": "always"
            }
        },
        // --------------------- SPLUNK ---------------------
        {
            "label": "[UTILS] â³ Wait 5 seconds",
            "type": "shell",
            "command": "sleep 5 && echo 'ğŸ• Waited 5 seconds...'",
            "presentation": {
                "reveal": "always",
                "panel": "shared",
                "group": "UTILS",
                "close": true,
            },
            "problemMatcher": []
        },
        // --------------------- Run Patch ---------------------
        {
            "label": "ğŸ©¹ğŸš€ Run Patch (macOS/Linux)",
            "type": "shell",
            "command": "sh migrateData.sh -e ${input:env} -t $TARGET_HOST -p $HTTP_ADMIN_PASSWORD -l $LOAD_TOKEN",
            "options": {
                "cwd": "${env:HOME}/src/github.com/aboveproperty/aboveproperty.data/cassandra/patches/${input:patchId}",
                "env": {
                    "CASSANDRA_HOST": "${input:cassandraHost}",
                    "TARGET_HOST": "${input:targetHost}",
                    "HTTP_ADMIN_PASSWORD": "${input:adminPassword}",
                    "TARGET": "${input:targetHost}",
                    "LOAD_TOKEN": "${input:loadToken}",
                    "MATLOCK_HOST": "${input:matlockHost}",
                    "SOLR_HOST": "${input:solrHost}"
                }
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "clear": true
            }
        },
        // --------------------- UMT / Bablefish ğŸ¡ ---------------------
        {
            "label": "ğŸ¡ ğŸ§± Build UMT (Java 17)",
            "type": "shell",
            "command": "export JAVA_HOME=/Library/Java/JavaVirtualMachines/amazon-corretto-17.jdk/Contents/Home; export PATH=$JAVA_HOME/bin:$PATH; mvn clean install -DskipTests=true",
            "options": {
                "cwd": "${env:HOME}//src/github.com/aboveproperty/aboveproperty.umt",
                "shell": {
                    "executable": "/bin/zsh",
                    "args": [
                        "-c"
                    ]
                }
            },
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸ¡ Start UMT",
            "type": "shell",
            "command": "java -jar $(ls target/babelfish-0.993.0.jar | head -n 1) server config/abvprp-dev/umt.yml",
            "options": {
                "cwd": "${env:HOME}/src/github.com/aboveproperty/aboveproperty.umt",
                "shell": {
                    "executable": "/bin/zsh",
                    "args": [
                        "-c"
                    ]
                }
            },
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸ¡ ğŸ§± Build & Start UMT",
            "dependsOn": [
                "ğŸ¡ ğŸ§± Build UMT (Java 17)",
                "ğŸ¡ Start UMT"
            ],
            "dependsOrder": "sequence"
        },
        {
            "label": "ğŸ¡ ğŸ” Open UMT Ping",
            "type": "shell",
            "command": "open https://localhost:8580/umt/v1/ping",
            "problemMatcher": []
        },
        {
            "label": "ğŸ¡ ğŸ”§ Build APS ğŸŒ (Java 11)",
            "type": "shell",
            "command": "export JAVA_HOME=/Library/Java/JavaVirtualMachines/amazon-corretto-11.jdk/Contents/Home; export PATH=$JAVA_HOME/bin:$PATH; mvn install -DskipTests=true",
            "options":{
                "cwd": "${env:HOME}/src/github.com/aboveproperty/aboveproperty.aps",
                "shell": {
                    "executable": "/bin/zsh",
                    "args": [
                        "-c"
                    ]
                }
            },
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸ¡ ğŸ”§ Build APS-Java-Client ğŸŒ (Java 11)",
            "type": "shell",
            "command": "export JAVA_HOME=/Library/Java/JavaVirtualMachines/amazon-corretto-11.jdk/Contents/Home; export PATH=$JAVA_HOME/bin:$PATH; mvn install -DskipTests=true",
            "options": {
                "cwd": "${env:HOME}/src/github.com/aboveproperty/aboveproperty.aps-java-client",
                "shell": {
                    "executable": "/bin/zsh",
                    "args": [
                        "-c"
                    ]
                }
            },
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸ¡ ğŸ”§ Build OTA ğŸ§³ (Java 17)",
            "type": "shell",
            "command": "export JAVA_HOME=/Library/Java/JavaVirtualMachines/amazon-corretto-17.jdk/Contents/Home; export PATH=$JAVA_HOME/bin:$PATH; mvn install",
            "options": {
                "cwd": "${env:HOME}/src/github.com/aboveproperty/aboveproperty.ota",
                "shell": {
                    "executable": "/bin/zsh",
                    "args": [
                        "-c"
                    ]
                }
            },
            "presentation": {
                "panel": "new", // ğŸ†• this makes each run use a fresh terminal 
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸ¡ ğŸ”§ Build External API ğŸŒ (Java 17)",
            "type": "shell",
            "command": "export JAVA_HOME=/Library/Java/JavaVirtualMachines/amazon-corretto-17.jdk/Contents/Home; export PATH=$JAVA_HOME/bin:$PATH; ./mvn_install.sh",
            "options": {
                "cwd": "${env:HOME}/src/github.com/aboveproperty/aboveproperty.external-api",
                "shell": {
                    "executable": "/bin/zsh",
                    "args": [
                        "-c"
                    ]
                }
            },
            "presentation": {
                "panel": "new",
                "reveal": "always"
            },
            "problemMatcher": []
        },
        {
            "label": "ğŸ¡ ğŸ§µ Build All Projects (APS â†’ UMT)",
            "type": "shell",
            "command": "echo \"Starting full APS/UMT buildâ€¦\"",
            "dependsOn": [
                "ğŸ¡ ğŸ”§ Build APS ğŸŒ (Java 11)",
                "ğŸ¡ ğŸ”§ Build APS-Java-Client ğŸŒ (Java 11)",
                "ğŸ¡ ğŸ”§ Build OTA ğŸ§³ (Java 17)",
                "ğŸ¡ ğŸ”§ Build External API ğŸŒ (Java 17)",
                "ğŸ¡ ğŸ§± Build UMT (Java 17)",
            ],
            "problemMatcher": []
        }
    ],
    "inputs": [
        {
            "id": "year",
            "type": "promptString",
            "description": "Enter year (e.g. 24 for 2024)",
            "default": "25"
        },
        {
            "id": "month",
            "type": "promptString",
            "description": "Enter month (e.g. 01 for January)",
            "default": "10"
        },
        {
            "id": "day",
            "type": "promptString",
            "description": "Enter start day (e.g. 01)",
            "default": "01"
        },
        {
            "id": "hour",
            "type": "promptString",
            "description": "Enter start hour (e.g. 05)",
            "default": "02"
        },
        {
            "id": "branch",
            "type": "promptString",
            "description": "Enter branch name (e.g. current, develop, feature-xyz)",
            "default": "current"
        },
        {
            "id": "logFile",
            "type": "pickString",
            "description": "Select log file",
            "options": [
                "babelfish",
                "profiler",
                "server",
                "trx-aps",
                "trx-babelfish",
                "trx-bonotel-rps",
                "trx-ctrip",
                "trx-derbysoft",
                "trx-expedia-rapid-availability",
                "trx-google",
                "trx-ota",
                "trx-tripadvisor",
                "trx"
            ],
            "default": "trx"
        },
        {
            "id": "serverURL",
            "type": "promptString",
            "description": "Enter server URL filter (e.g. ip-10-20-1-8, west, prod.abvprp.com) null value gets all"
        },
        {
            "id": "patchId",
            "type": "promptString",
            "description": "Patch folder name under cassandra/patches/",
            "default": "US99999"
        },
        {
            "id": "env",
            "type": "pickString",
            "description": "Environment flag for migrateData.sh (-e)",
            "options": [
                "dev",
                "qa",
                "stg",
                "prod"
            ],
            "default": "dev"
        },
        {
            "id": "cassandraHost",
            "type": "promptString",
            "description": "CASSANDRA_HOST",
            "default": "localhost"
        },
        {
            "id": "targetHost",
            "type": "promptString",
            "description": "TARGET_HOST (APS API/Tomcat)",
            "default": "http://localhost:8080"
        },
        {
            "id": "matlockHost",
            "type": "promptString",
            "description": "MATLOCK_HOST",
            "default": "http://localhost:8087"
        },
        {
            "id": "solrHost",
            "type": "promptString",
            "description": "SOLR_HOST",
            "default": "http://localhost:8983"
        },
        {
            "id": "adminPassword",
            "type": "promptString",
            "description": "HTTP_ADMIN_PASSWORD",
            "password": true,
            "default": "password1"
        },
        {
            "id": "loadToken",
            "type": "promptString",
            "description": "LOAD_TOKEN",
            "password": true,
            "default": "ioanscion2893eionsan28903e23nsinasune9udh23987h239dnqnasiun7qhd2983en31dcjnu982h239d"
        }
    ]
}